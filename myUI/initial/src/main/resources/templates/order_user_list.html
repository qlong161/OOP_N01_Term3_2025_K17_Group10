<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Qu·∫£n l√Ω ƒë∆°n h√†ng c·ªßa [[${user.name}]]</title>
    <style>
        body { font-family: Arial; margin: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
        th { background-color: #f2f2f2; }
        form.inline { display: inline; }
        .box { margin-top: 20px; padding: 10px; border: 1px solid #ccc; }
        .total { font-weight: bold; }
    </style>
</head>
<body>

<h2>ƒê∆°n h√†ng c·ªßa ng∆∞·ªùi d√πng: <span th:text="${user.name}">T√™n ng∆∞·ªùi d√πng</span></h2>

<p class="total">T·ªïng doanh thu: <span th:text="${totalRevenue} + ' VNƒê'">0 VNƒê</span></p>

<a href="/userlist">‚¨Ö Quay l·∫°i danh s√°ch ng∆∞·ªùi d√πng</a>

<!-- B·ªô l·ªçc tr·∫°ng th√°i -->
<div class="box">
    <form th:action="@{'/order/user/' + ${user.id} + '/filter'}" method="get">
        <label>L·ªçc theo tr·∫°ng th√°i:</label>
        <select name="status">
            <option value="New">New</option>
            <option value="Processing">Processing</option>
            <option value="Completed">Completed</option>
        </select>
        <button type="submit">L·ªçc</button>
    </form>
</div>

<!-- Danh s√°ch ƒë∆°n h√†ng -->
<table>
    <thead>
        <tr>
            <th>M√£ ƒë∆°n</th>
            <th>Kh√°ch h√†ng</th>
            <th>Ng√†y</th>
            <th>Tr·∫°ng th√°i</th>
            <th>S·∫£n ph·∫©m</th>
            <th>H√†nh ƒë·ªông</th>
        </tr>
    </thead>
    <tbody>
        <tr th:each="order : ${orders}">
            <td th:text="${order.orderId}">M√£ ƒë∆°n</td>
            <td th:text="${order.customer.name}">Kh√°ch h√†ng</td>
            <td th:text="${#temporals.format(order.date, 'dd/MM/yyyy HH:mm')}">Ng√†y</td>
            <td th:text="${order.status}">Tr·∫°ng th√°i</td>
            <td>
                <ul>
                    <li th:each="entry : ${order.items}">
                        <span th:text="${entry.key.name}">T√™n SP</span> -
                        <span th:text="${entry.value}">SL</span> c√°i
                    </li>
                </ul>
            </td>
            <td>
                <!-- C·∫≠p nh·∫≠t tr·∫°ng th√°i -->
                <form method="post" action="/order/update" class="inline">
                    <input type="hidden" name="orderId" th:value="${order.orderId}" />
                    <input type="hidden" name="userId" th:value="${user.id}" />
                    <select name="status">
                        <option value="New" th:selected="${order.status == 'New'}">New</option>
                        <option value="Processing" th:selected="${order.status == 'Processing'}">Processing</option>
                        <option value="Completed" th:selected="${order.status == 'Completed'}">Completed</option>
                    </select>
                    <button type="submit">‚úî C·∫≠p nh·∫≠t</button>
                </form>

                <!-- Xo√° ƒë∆°n h√†ng -->
                <form method="post" action="/order/delete" class="inline"
                      onsubmit="return confirm('Xo√° ƒë∆°n h√†ng n√†y?')">
                    <input type="hidden" name="orderId" th:value="${order.orderId}" />
                    <input type="hidden" name="userId" th:value="${user.id}" />
                    <button type="submit">üóëÔ∏è Xo√°</button>
                </form>
            </td>
        </tr>
    </tbody>
</table>

<!-- Th√™m ƒë∆°n h√†ng m·ªõi -->
<div class="box">
    <h3>Th√™m ƒë∆°n h√†ng m·ªõi</h3>
    <form method="post" action="/order/add">
        <input type="hidden" name="userId" th:value="${user.id}" />
        <label>M√£ ƒë∆°n h√†ng:</label>
        <input type="text" name="orderId" required><br><br>

        <label>Ch·ªçn kh√°ch h√†ng:</label>
        <select name="customerId">
            <option th:each="c : ${customers}" th:value="${c.customerId}" th:text="${c.name}">Kh√°ch h√†ng</option>
        </select><br><br>

        <label>Ch·ªçn s·∫£n ph·∫©m v√† s·ªë l∆∞·ª£ng:</label><br>
        <div th:each="product : ${products}">
            <label>
                <span th:text="${product.name} + ' (' + product.price + ' VNƒê)'"></span>
                <input type="number" th:attr="name=${'product_' + product.id}" value="0" min="0" />
            </label><br>
        </div><br>

        <button type="submit">‚ûï T·∫°o ƒë∆°n h√†ng</button>
    </form>
</div>

</body>
</html>
